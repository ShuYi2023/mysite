<p><strong>用Django创建ue5的教程网站</strong></p><p><strong>格式提醒</strong></p><ul><li>文章中使用了平方根运算符, 这个符号将来会用 ycb-ysuper 替代.</li></ul><p><img src="1.png" /></p><p><img src="2.png" /></p><ul><li>平方根符号后面千万不能跟一个空格, 否则mammoth 在解析 docx 文档的时候会报错.</li></ul><p><strong>创建虚拟环境</strong></p><ul><li>√在Pycharm中创建虚拟环境 ue5web</li><li>√在虚拟环境中 conda install安装 django</li><li>√激活环境、创建项目</li></ul><table><tr><td><p>Bash<br />D:\my_projs\08feishu\django_prjs&gt;conda activate ue5web  # 激活虚拟环境<br />(ue5web) D:\my_projs\08feishu\django_prjs&gt;django-admin startproject ue5web # 创建文件夹和项目</p></td></tr></table><p><img src="3.png" /></p><p><img src="4.png" /></p><p><strong>urls.py, views.py, models.py 和 Template 的关系</strong></p><p><img src="5.png" /></p><ul><li>HTTP Request: 用户访问一个网址, Request 中常常带有参数</li><li>urls.py 根据一定的规则, 把网址传递给匹配的 views.py 函数.</li><li>View 中的函数会读取 Model 中的数据 + Template, 把页面呈现给客户.</li><li>Model 可以理解为数据库.</li></ul><p><strong>模板</strong></p><p><img src="6.png" /></p><ul><li>注意↑, 这种写法很聪明. 相当于获得 article 的 article_list 的 view。而不用给出绝对的 url 值.</li></ul><p><strong>静态文件</strong></p><p><img src="7.png" /></p><ul><li>√在 Django 3 和 4 中, 加载静态文件的语法是 load static, 而不是 load staticfiles .</li></ul><p><strong>HTML页面Source的乱码问题</strong></p><p><strong>用safe过滤</strong></p><ul><li>html代码</li></ul><table><tr><td><p>HTML<br />&lt;p class=&quot;card-text&quot;&gt;{{ article.body|slice:'100'|safe }}...&lt;/p&gt;</p></td></tr></table><p><img src="8.png" /></p><ul><li>↑ 这里要用上 safe , 才能让 Django 正确渲染Body 中的 HTML 标记.</li></ul><p><strong>slice的问题</strong></p><p><img src="9.png" /></p><table><tr><td><p>HTML<br />&lt;p class=&quot;card-text&quot;&gt;{{ article.body|slice:'100'|safe }}...&lt;/p&gt;</p></td></tr></table><p><strong>CheckBox 中的对钩不变色</strong></p><ul><li>里面的对钩用了一个特殊的字符, 这个字符不支持改变颜色. 可以暂时把对钩用字母 V 表示.</li><li>√对钩问题是 CheckGet的一个大重点。以后可以进一步完善.</li><li>√例如, 可以在后台统计学员是否 Check 了对钩.</li></ul><p><strong>mammoth</strong></p><ul><li>可以用Python 的 mammoth把 docx 文档转换为 html, 要在虚拟环境的 terminal 下执行命令↓</li></ul><table><tr><td><p>Bash<br /># 虚拟环境/路径/命令<br /><strong>(ue5web) maxmacboookpro2019@myPro doc2html %</strong> mammoth 'blueprints初级教程-1-崇礼.docx' --output-dir='imgs' </p></td></tr></table><ul><li>参考网址: https://pypi.org/project/mammoth/#image-converters.</li></ul><p><strong><em>DJANGO_SETTINGS_MODULE </em></strong></p><ul><li>如果要用脚本向数据库添加文章, 系统会要求: <em>define the environment variable DJANGO_SETTINGS_MODULE or call settings.configure() before accessing settings.</em></li><li>网上的解决办法如下↓ (我不推荐)</li></ul><table><tr><td><p><img src="10.png" /></p></td><td><p><img src="11.png" /></p></td></tr></table><ul><li>√但系统又会报错: django.core.exceptions.AppRegistryNotReady: Apps aren't loaded yet.</li><li>√我的解决方案如下↓. 注意 第5行不能放到 3、4 行的前面, 因为必须设置好了环境变量, 才能 import.</li></ul><table><tr><td><p>Python<br />import django<br />import os<br />os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'ue5web.settings')<br />django.setup() # 如果没有第4行, 会报错: django.core.exceptions.AppRegistryNotReady: Apps aren't loaded yet.<br />from article.models import ArticlePost</p></td></tr></table><p><strong>replace()不 work</strong></p><ul><li>replace()方法不是 inplace replacement. 所以下面第 4 行的写法在第 9 行使用的时候, 不会有效果, 因为 text_for_post 并没有改变. <strong>要在第 5 行给 text_for_post 重新赋值</strong>. </li></ul><table><tr><td><p>Python<br />if old_text in text_for_post:<br />    yseq += 1<br />    new_text = new_text_begin + str(yseq) + new_text_end<br />    # text_for_post.replace(old_text, new_text, 1)<br />    text_for_post = text_for_post.replace(old_text, new_text, 1)<br />    <br />    obj, created = ArticlePost.objects.update_or_create(<br />    title = ydoc_name,<br />    defaults = {&quot;body&quot;: str(datetime.datetime.now()) + text_for_post}<br />)</p></td></tr></table>